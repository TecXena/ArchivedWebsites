if (self.CavalryLogger) { CavalryLogger.start_js(["yoHfl"]); }

__d("SendAPIDialogButton",["Button"],(function(a,b,c,d,e,f){e.exports={monitor:function(a){var c=document.getElementsByName("publish")[0],d="TypeaheadBehaviors";Object.assign(window[d]||(window[d]={}),{SendAPIDialogButtonActivate:function(d){d.subscribe("select",function(){b("Button").setEnabled(c,1)}),d.subscribe("blur",function(){var d=a.getTokenValues();b("Button").setEnabled(c,d&&d.length)})}})}}}),null);
__d("legacy:connect-xd",["XD"],(function(a,b,c,d,e,f){a.UnverifiedXD=b("XD").UnverifiedXD,a.XD=b("XD").XD}),3);
__d("LitestandLinkHider",["DataStore","DOMQuery","Event","Parent","UserAgent_DEPRECATED"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){var c=a.getTarget();c=b("Parent").byTag(c,"a");if(!(c instanceof HTMLAnchorElement))return;a.type==="mouseover"?(b("DataStore").set(c,"href",c.href),c.removeAttribute("href")):(c.href=b("DataStore").get(c,"href")||c.href,a.type==="mouseout"&&b("DataStore").remove(c,"href"))}var h={hideLinks:function(a){(b("UserAgent_DEPRECATED").chrome()||b("UserAgent_DEPRECATED").ie()>=9||b("UserAgent_DEPRECATED").opera())&&b("Event").listen(a,{mouseover:g,mouseout:g,mousedown:g})},removeAllHrefs:function(a,c){__p&&__p();c===void 0&&(c=null);a=b("DOMQuery").scry(a,"a");a.forEach(function(a){if(Array.isArray(c)&&a.classList&&a.classList instanceof DOMTokenList&&c.some(function(b){return Array.from(a.classList.values()).indexOf(b)!==-1}))return;a.removeAttribute("href");a.removeAttribute("ajaxify");a.removeAttribute("rel");a.setAttribute("tabindex",0)})},removeClickable:function(a,c,d){h.removeAllHrefs(a,d);d=b("DOMQuery").scry(a,"."+c+" a");d.forEach(function(a){a.removeAttribute("onclick"),a.removeAttribute("onmouseover")})}};e.exports=h}),null);
__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c,d,e,f){"use strict";this.$1=a,c&&(this.$2=c,this.$3=d,this.$5=e,this.$4=f,b("Arbiter").subscribe("Tokenizer/init",this.$7.bind(this)),b("Event").listen(this.$5,"click",this.$8.bind(this)))}a.prototype.removeHiddenPrivacyWidget=function(){"use strict";[this.$1,this.$2,this.$4].forEach(function(a){a&&b("CSS").hasClass(a,"hidden_elem")&&b("DOM").remove(a)})};a.prototype.$8=function(){"use strict";if(this.$6==null||typeof this.$6.removeAllTokens!=="function")return;this.$6.removeAllTokens();this.$9(null,null)};a.prototype.$7=function(a,c){"use strict";if(this.$6||this.$3!=c.element)return;this.$6=c;this.$9(null,null);b("Arbiter").subscribe("Form/change",this.$9.bind(this))};a.prototype.$9=function(a,b){"use strict";if(this.$6==null||typeof this.$6.getTokens!=="function")return;a=this.$6.getTokens().length>0;this.$10(a)};a.prototype.$10=function(a){"use strict";this.$2&&b("CSS").conditionShow(this.$2,a),this.$1&&b("CSS").conditionShow(this.$1,!a),this.$4&&b("CSS").conditionShow(this.$4,a)};e.exports=a}),null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],(function(a,b,c,d,e,f){__p&&__p();function g(a){"use strict";__p&&__p();if(!a)return;if(a.getCore().getHiddenValue()){var c={uid:a.getCore().getHiddenValue(),text:a.getCore().getValue()};b("Arbiter").inform("PhotoAlbumPlacesTypeahead.EXIST_PLACE",c)}a.subscribe("select",function(c,a){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.SELECTED_PLACE",a.selected)}.bind(this));a.subscribe("reset",function(){a.getCore().getHiddenValue()||b("Arbiter").inform("PhotoAlbumPlacesTypeahead.RESET_PLACE")}.bind(this));a.subscribe("focus",function(){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.FOCUSED")}.bind(this));this._initialized=!0}g.prototype.init=function(a){"use strict";if(this._initialized)return;g.call(this,a)};e.exports=g}),null);
__d("PersistentAlbumDataStore",["WebStorage"],(function(a,b,c,d,e,f){__p&&__p();var g="fb_album_recovery",h=7*60*60*24,i={_storageExists:!0,_initializeWebStorage:function(){var a=b("WebStorage").getLocalStorage();if(!a){i._storageExists=!1;return}a.getItem(g)||a.setItem(g,JSON.stringify({}))},_getAlbumsObject:function(){if(!i._storageExists)return{};i._initializeWebStorage();return JSON.parse(b("WebStorage").getLocalStorage().getItem(g))},_setAlbumsObject:function(a){if(!i._storageExists)return;i._initializeWebStorage();b("WebStorage").getLocalStorage().setItem(g,JSON.stringify(a))},_getLocalStorageByAlbum:function(a){return i._getAlbumsObject()[a]||i.createAlbum(a)},_setLocalStorageByAlbum:function(a,b){var c=i._getAlbumsObject();c[a]=b;i._setAlbumsObject(c)},createAlbum:function(a){var b={privacy:null,tags:{},created_at:Date.now()};i._setLocalStorageByAlbum(a,b);return b},deleteAlbum:function(a){var b=i._getAlbumsObject();delete b[a];i._setAlbumsObject(b)},getAlbumPrivacy:function(a){return i._getLocalStorageByAlbum(a).privacy},setAlbumPrivacy:function(a,b){var c=i._getLocalStorageByAlbum(a);c.privacy=b;i._setLocalStorageByAlbum(a,c)},saveTag:function(a,b,c){var d=i._getLocalStorageByAlbum(a);d.tags[b]||(d.tags[b]=[]);c.recovered=!0;d.tags[b].push(c);i._setLocalStorageByAlbum(a,d)},removeTag:function(a,b,c){var d=i._getLocalStorageByAlbum(a),e=d.tags[b]||[];for(var f=0;f<e.length;f++)if(e[f].subject===c||e[f].name===c){e.splice(f,1);break}d.tags[b]=e;i._setLocalStorageByAlbum(a,d)},getTags:function(a,b){return i._getLocalStorageByAlbum(a).tags[b]||[]},deleteExpiredAlbums:function(){var a=i._getAlbumsObject();for(var b in a){var c=a[b];Date.now()-c.created_at>h*1e3&&i.deleteAlbum(b)}}};e.exports=i}),null);
__d("XFamilyBulkTagAddAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/family/bulk_tag_save/",{subject:{type:"Int"},save_tags:{type:"String"}})}),null);
__d("PhotoTagStore",["ActorURI","AsyncRequest","XFamilyBulkTagAddAsyncController","isEmpty"],(function(a,b,c,d,e,f){__p&&__p();function g(){"use strict";this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={},g.instance=this}g.prototype.getPhotoTags=function(a){"use strict";return this._tagList[a]||{}};g.prototype.photoHasTags=function(a){"use strict";return!b("isEmpty")(this.getPhotoTags(a))};g.prototype.clear=function(){"use strict";this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={}};g.prototype.addTag=function(a,b,c,d){"use strict";a[b]=a[b]||{};var e=a[b][c]||[];e.push(d);a[b][c]=e};g.prototype.revert=function(a){"use strict";var c=this._tagList,d=this._originalTagList;for(var e in c)b("isEmpty")(d[e][a])?c[e][a]=[]:c[e][a]=d[e][a];this._dirtyPhotosByUid={}};g.prototype.hasNewTags=function(){"use strict";return!b("isEmpty")(this._tagList)||!b("isEmpty")(this._textTagList)};g.prototype.userHasDirtyTags=function(a){"use strict";return!b("isEmpty")(this._dirtyPhotosByUid[a])};g.prototype.userDirtyTagsCount=function(a){"use strict";return Object.keys(this._dirtyPhotosByUid[a]).length};g.prototype.handleTagFetch=function(a){"use strict";for(var b in a)this.loadTagInfo(b,a[b])};g.prototype.saveAlbumTagsForUser=function(a,c,d,e){__p&&__p();e===void 0&&(e=!1);var f={},g=[],h=this._dirtyPhotosByUid[a]||{};for(var i in h){h=this._tagList[i][a];if(b("isEmpty")(h)){g[g.length]=i;continue}h.forEach(function(a){f[i]={x:a.x,y:a.y}})}h={subject:a,action:"save",save_tags:f};g=b("ActorURI").create("/ajax/photos/album/tags.php",c);e&&(h={subject:a,save_tags:JSON.stringify(f)},g=b("XFamilyBulkTagAddAsyncController").getURIBuilder().getURI());new(b("AsyncRequest"))().setURI(g).setData(h).setHandler(function(a){d(a.payload)}).setAllowCrossPageTransition(!0).send();delete this._dirtyPhotosByUid[a]};g.prototype.getTagsFromList=function(a){"use strict";var b=[];for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c))for(var d in a[c])Object.prototype.hasOwnProperty.call(a[c],d)&&a[c][d].forEach(function(a){return b.push(a)});return b};g.prototype.getAllTags=function(){"use strict";var a=this.getTagsFromList(this._tagList),b=this.getTagsFromList(this._textTagList);return a.concat(b)};g.prototype.removeTag=function(a,c){"use strict";__p&&__p();var d=this._tagList[a],e=this._originalTagList[a]||{};e[c]?(this._dirtyPhotosByUid[c]=this._dirtyPhotosByUid[c]||{},this._dirtyPhotosByUid[c][a]=!0):delete this._dirtyPhotosByUid[c][a];for(var f in d)if(f==c){e=this._tagList[a][f];delete this._tagList[a][f];b("isEmpty")(this._tagList[a])&&delete this._tagList[a];return e}};g.prototype.removeTextTag=function(a,c){"use strict";var d=this._textTagList[a];if(!b("isEmpty")(d[c])){d=this._textTagList[a][c];this._textTagList[a][c]=[];b("isEmpty")(this._textTagList[a])&&delete this._textTagList[a];return d}return[]};g.prototype.removeAllNewTagsOfUser=function(a){"use strict";var b=[];if(!this.userHasDirtyTags(a))return b;var c=this._dirtyPhotosByUid[a];for(var d in c)b=b.concat(this.removeTag(d,a));return b};g.prototype.removeAllTagsFromPhoto=function(a){"use strict";__p&&__p();var c=[];if(!b("isEmpty")(this._tagList[a]))for(var d in this._tagList[a]){if(!Object.prototype.hasOwnProperty.call(this._tagList[a],d))continue;c=c.concat(this.removeTag(a,d))}if(!b("isEmpty")(this._textTagList[a]))for(var e in this._textTagList[a]){if(!Object.prototype.hasOwnProperty.call(this._textTagList[a],e))continue;c=c.concat(this.removeTextTag(a,e))}return c};g.prototype.storeTag=function(a,b,c,d,e){"use strict";this.storeTagWithOptions(a,b,c,d,{can_remove:e})};g.prototype.storeTagWithOptions=function(a,b,c,d,e){"use strict";this._dirtyPhotosByUid[b]=this._dirtyPhotosByUid[b]||{};this._dirtyPhotosByUid[b][a]=!0;c={x:c,y:d};Object.assign(c,e);!b?this.addTag(this._textTagList,a,c.name,c):this.addTag(this._tagList,a,b,c)};g.prototype.loadTagInfo=function(a,b){"use strict";this._tagList[a]={};this._originalTagList[a]={};for(var c=0;c<b.length;c++){var d=b[c];this.addTag(this._tagList,a,d.subject,d);this.addTag(this._originalTagList,a,d.subject,d)}};g.getInstance=function(){"use strict";g.instance===null&&new g();return g.instance};g.instance=null;e.exports=g}),null);
__d("PhotoBulkEditTagger",["csx","Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Parent","PersistentAlbumDataStore","PhotosConst","PhotosTaggingWaterfall","PhotoTagger","PhotoTagStore","SubscriptionsHandler","Vector","$","ge"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i=60;c=babelHelpers.inherits(a,b("PhotoTagger"));h=c&&c.prototype;function a(a,c,d,e){"use strict";h.constructor.call(this,a),this.editor=a,this.faceboxes=[],this._qn=e.qn,this.tokenizer=d,this.editor.registerTagger(this),this.typeahead=d.getTypeahead(),this.handlers=new(b("SubscriptionsHandler"))(),this.root=this.editor.getRoot(),this.tagger=c,this.hideNewTagTimer=null,this.photoKey=null,this._needTaggingData=!0,this._currentRecognition={box:null,isTagged:!1,suggestion:null},this._hoverState=!1,this._tagging=!1,this.setupHandlers(),this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").BEGIN),this.fetchTaggingSuggestions(),this.setTagAccumulator(e.bulkSaveTags),this.setNeedTaggingData(e.needTaggingData),this.version=b("PhotosConst").BULK_EDITOR,b("Event").listen(this.root,"mousemove",function(a){a=a.getTarget();this._hoverState&&!(b("Parent").byClass(a,"faceBox")||b("Parent").byClass(a,"tagPointer")||b("Parent").byClass(a,"arrow")||b("Parent").byClass(a,"faceboxSuggestion"))&&(this.removeSuggestionFromTagger(),this.hideTagger())}.bind(this))}a.prototype.setupUserActionLogging=function(){"use strict";return null};a.prototype.logUserActionEvent=function(a){"use strict";return null};a.prototype.addFaceboxes=function(a){"use strict";__p&&__p();this.faceboxes=b("DOMQuery").scry(a.parentNode,".faceBox");this.faceboxes.sort(function(a,b){return a.offsetLeft===b.offsetLeft?a.offsetTop-b.offsetTop:a.offsetLeft-b.offsetLeft});var c=b("Parent").byClass(a,"editablePhoto"),d=b("PhotoTagStore").getInstance().getPhotoTags(c.getAttribute("data-photoid")),e=[];Object.keys(d).forEach(function(a){d[a].fbid&&(e[d[a].fbid]=!0)});this.faceboxes.forEach(function(c){var f=this.getFaceboxSuggestionFromFaceboxElem(c),g=c.getAttribute("data-faceboxid");if(f&&d[f.getAttribute("data-id")]||e[g]){b("DOM").remove(c);return}f={image:a,facebox:c};b("Event").listen(c,"mouseenter",this._mouseOverFacebox.bind(this,f))}.bind(this))};a.prototype.saveTag=function(a,c,d){"use strict";if(!c.info.recovered){h.saveTag.call(this,a,c,d);a=this.getTaggingDataForSave(c,d);b("PersistentAlbumDataStore").saveTag(this.photoData.albumFBID,this.photoData.fbid,a)}b("Arbiter").inform("PhotoBulkEditTagger.TAG_SAVED",{editor:this.root,fbid:this.photoData.fbid})};a.prototype.recoverPhoto=function(a){"use strict";this.setupPhotoDataForTarget(a.getRoot());a=b("PersistentAlbumDataStore").getTags(this.photoData.albumFBID,this.photoData.fbid);a.forEach(function(a){var c=this.tokenizer.createToken({uid:a.subject?a.subject:a.name,text:a.name,suggestion:a.from_facebox,freeform:a.subject==="",recovered:!0});this.tokenizer.addToken(c);b("PhotoTagStore").getInstance().storeTagWithOptions(this.photoData.fbid,a.subject,a.x,a.y,a)}.bind(this))};a.prototype.setNeedTaggingData=function(a){"use strict";this._needTaggingData=a;return this};a.prototype.setTagAccumulator=function(a){"use strict";h.setTagAccumulator.call(this,a);return this};a.prototype.needTaggingData=function(){"use strict";return this._needTaggingData};a.prototype.setupHandlers=function(){"use strict";b("Event").listen(this.root,"click",this.clickHandler.bind(this)),this.tokenizer.subscribe(["addToken","removeToken"],this.handleTokenAction.bind(this)),this.tokenizer.subscribe("switchTarget",this.switchPhoto.bind(this)),this.tokenizer.subscribe("initialized",this.editor._recoverPhotos.bind(this.editor)),b("Arbiter").subscribe("PhotoBulkEditTagger.DATA_SOURCE_READY",this.useTaggingDataSource.bind(this)),b("Arbiter").subscribe(this.editor.mapEventNameToNamespace("PhotosBulkEditor.PHOTO_REORDER_START"),this.hideTagger.bind(this))};a.prototype.hideTagger=function(){"use strict";h.hideTagger.apply(this,arguments),this._currentRecognition.box&&!this._currentRecognition.isTagged&&b("CSS").show(this._currentRecognition.box),this._tagging=!1,this._hoverState=!1,this._currentRecognition.box=null,this._currentRecognition.isTagged=!1,this._currentRecognition.suggestion=null,this.recognizedUsers=[]};a.prototype.done=function(){"use strict";this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").FINISH)};a.prototype.handleTokenAction=function(a,c){"use strict";__p&&__p();var d=b("$")(this.photoKey),e=b("DOM").find(d,".peopleIcon");d=b("DOM").find(d,".editablePhotoTagList");var f=b("DOM").find(e,".count"),g=this.tokenizer.getTokens().length,h=c.info.suggestion?b("FaceboxSourceConstants").UPLOADER_SUGGEST:null;this._currentRecognition.box&&(this._currentRecognition.isTagged=!!g);b("CSS").conditionClass(e,"hasPeople",!!g);b("CSS").conditionClass(d,"hasPeople",!!g);b("DOM").setContent(f,g);if(a=="addToken"){this.saveTag(a,c,h);return}else this.removeTag(a,c),b("PersistentAlbumDataStore").removeTag(this.photoData.albumFBID,this.photoData.fbid,c.info.uid),b("Arbiter").inform("PhotoBulkEditTagger.TAG_REMOVED",{editor:this.root,fbid:this.photoData.fbid})};a.prototype.useTaggingDataSource=function(a,b){"use strict";if(!this._needTaggingData)return;a=this.tokenizer.getTypeahead();a.swapData(b);this.setNeedTaggingData(!1)};a.prototype.getTaggerPositioningOrigin=function(){"use strict";return b("Vector").getElementPosition(this.root)};a.prototype.getRecognitionBoxCenter=function(a,c){"use strict";a=b("Vector").getElementPosition(a).add(b("Vector").getElementDimensions(a).mul(.5));var d=b("Vector").getElementDimensions(this._currentRecognition.box);c=this.calcTaggerPosition(c,a,d.x,d.y);return{boxPos:a,boxDim:d,taggerPos:c}};a.prototype.setUpTagger=function(a,c,d,e,f){"use strict";this.calcClickPoint(a,d),f.setElementPosition(this.tagger),e&&e.setElementDimensions(this.tagger),b("CSS").hide(b("DOM").find(c,".clickToTagMessage")),this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").TAG_FACE),this.updateTypeaheadSuggestions(),this.updateWithSuggestions(),this.showTagger(),this._tagging=!0};a.prototype.clickHandler=function(a){"use strict";__p&&__p();var c=a.getTarget();if(b("Parent").byClass(c,"photoTagTypeahead"))return;if(this._hoverState){this._hoverState=!1;this._tagging=!0;return}this.tagger&&(this.hideTagger(),this.removeSuggestionFromTagger(),this.handlers.release());if(b("Parent").byClass(c,"photoContextualSelector")||b("Parent").byClass(c,"removePhotoButton"))return;var d=b("Parent").byClass(c,"editablePhotoImage");if(!d){var e=b("Parent").byClass(c,"peopleIcon");e&&this.setupPhotoDataForTarget(e);return}if(b("DOMQuery").scry(d,".clickToTagMessage").length===0)return;this.setupPhotoDataForTarget(d);e=b("DOM").find(d,".scaledImage img");var f=null,g=null,h=null,j=b("Parent").byClass(c,"faceBox");j||(j=b("Parent").byClass(c,"recognitionBox"));this._currentRecognition.box=j;if(this._currentRecognition.box&&b("CSS").shown(this._currentRecognition.box)){c=this.getRecognitionBoxCenter(j,e);f=c.boxPos;g=c.boxDim;h=c.taggerPos;b("CSS").hide(this._currentRecognition.box);this._currentRecognition.isTagged=!1;c=this.getFaceboxSuggestionFromFaceboxElem(j);c?(this._currentRecognition.suggestion=c,this.addSuggestionToTagger(j,c),this._sendFaceboxSuggestionLogSignal(c.getAttribute("data-id"),b("FaceboxSourceConstants").UPLOADER_SUGGEST)):this.recognizedUsers=JSON.parse(j.getAttribute("data-recognizeduids"))}h===null&&(f=b("Vector").getEventPosition(a),h=this.calcTaggerPosition(e,f,i));if(!h)return;this.setUpTagger(e,d,f,g,h)};a.prototype._mouseOverFacebox=function(a){"use strict";__p&&__p();if(this._tagging)return;var c=a.image;a=a.facebox;var d=this.getFaceboxSuggestionFromFaceboxElem(a);if(d){this._hoverState=!0;this._currentRecognition.box=a;this._currentRecognition.suggestion=d;this.setupPhotoDataForTarget(c);this.addSuggestionToTagger(a,d);this._sendFaceboxSuggestionLogSignal(d.getAttribute("data-id"),b("FaceboxSourceConstants").UPLOADER_SUGGEST);this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").HOVER_TAG_FACE);d=b("Vector").getElementPosition(a).add(b("Vector").getElementDimensions(a).mul(.5));a=b("Vector").getElementDimensions(this._currentRecognition.box);var e=this.calcTaggerPosition(c,d,a.x,a.y);this.calcClickPoint(c,d);e.setElementPosition(this.tagger);a.setElementDimensions(this.tagger);this.showTagger()}};a.prototype.fetchTaggingSuggestions=function(){"use strict";this.logUserActionEvent("sugg_fetch"),new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.logUserActionEvent("sugg_fetch_done")}.bind(this)).send()};a.prototype.switchPhoto=function(a,c){"use strict";a=b("ge")(c);a&&this.setupPhotoDataForTarget(a);this.hideTagger()};a.prototype.getImageByID=function(a){"use strict";return b("ge")("editablePhoto_"+a)};a.prototype.setupPhotoDataForTarget=function(a){"use strict";__p&&__p();var c;a&&!b("CSS").hasClass(a,"editablePhoto")?c=b("Parent").byClass(a,"editablePhoto"):c=a;if(!c){this.photoKey=null;this.photoData=null;return!1}a=c.id;if(a===this.photoKey)return;this.photoKey=a;this.photoData=this.editor.getPhotoData(a);this.tokenizer.setTokenarea(b("DOM").find(c,"div.editablePhotoTagList"))};a.prototype.getPosition=function(){"use strict";return this.photoData.fbid};a.prototype.tagsChangeHandler=function(a){"use strict"};a.prototype.removeTagByID=function(a,b,c){"use strict";this.hideTagger(),this.setupPhotoDataForTarget(this.getImageByID(a)),h.removeTagByID.call(this,a,b,c)};a.prototype.setupFaceboxSuggestionHandlers=function(a,c){"use strict";var d=b("DOM").find(c,"._570w"),e=b("DOM").find(c,"._570x");this.handlers.engage();this.handlers.addSubscriptions(b("Event").listen(d,"click",function(d){this.dismissFaceboxSuggestion(a.id.replace("face:",""),c.getAttribute("data-id"),this.photoData.owner,b("FaceboxSourceConstants").UPLOADER_DISMISS),this.removeSuggestionFromTagger(),this.hideTagger(),b("DOM").remove(this.getFaceboxSuggestionFromFaceboxElem(a))}.bind(this)),b("Event").listen(e,"click",function(d){d=this.tokenizer.createToken({uid:c.getAttribute("data-id"),text:c.getAttribute("data-text"),suggestion:!0});this.removeSuggestionFromTagger();b("CSS").hide(a);this.tokenizer.addToken(d)}.bind(this)))};Object.assign(a.prototype,{elemNames:{}});e.exports=a}),null);
__d("PhotoBulkEditTokenizer",["DOM","Event","Input","Parent","Tokenizer","UserAgent_DEPRECATED","getObjectValues"],(function(a,b,c,d,e,f){__p&&__p();var g,h;g=babelHelpers.inherits(a,b("Tokenizer"));h=g&&g.prototype;a.prototype.init=function(a,b,c,d){"use strict";this._tokenareaListeners={},h.init.call(this,a,b,c,d),this.inform("initialized")};a.prototype.initEvents=function(){"use strict";var a=b("UserAgent_DEPRECATED").firefox()<4?"keypress":"keydown";b("Event").listen(this.input,"paste",this.paste.bind(this));b("Event").listen(this.input,a,this.keydown.bind(this))};a.prototype.setTokenarea=function(a){"use strict";this.tokenarea=a,this.addTokenareaListener(a),this.reset()};a.prototype.addTokenareaListener=function(a){"use strict";if(this._tokenareaListeners[a.id])return;var c=this.handleEvents.bind(this);this._tokenareaListeners[a.id]=b("getObjectValues")(b("Event").listen(a,{click:c,keydown:c}))};a.prototype.handleEvents=function(a){"use strict";var c=b("Parent").byClass(a.getTarget(),"editablePhotoTagList");if(!c)return;else this.tokenarea!==c&&(this.setTokenarea(c),this.inform("switchTarget",this.tokenarea.id));return h.handleEvents.call(this,a)};a.prototype.reset=function(){"use strict";var a=this.getTokenElements().map(function(a){return{uid:b("DOM").scry(a,"input")[0].value,text:b("DOM").scry(a,"input")[1].value}});b("Input").reset(this.input);return h.reset.call(this,a)};a.prototype.updateTokenareaVisibility=function(){"use strict";return null};a.prototype.insertToken=function(a){"use strict";b("DOM").prependContent(this.tokenarea,a.getElement())};function a(){"use strict";g.apply(this,arguments)}e.exports=a}),null);
__d("PhotosBulkEditablePhotoPlaceholder",["csx","CSS","DOM","Event","mixInEventEmitter"],(function(a,b,c,d,e,f,g){__p&&__p();function a(a,b,c){"use strict";this._root=a,this._progressBar=b,this._uploadID=c,this._initAndGetGatedButton("._3273","cancelButtonClicked"),this._retryButton=this._initAndGetGatedButton("._3p03","retryButtonClicked"),this._errorOkayButton=this._initAndGetGatedButton("._8qx","dismissPlaceholder"),this._errorCloseButton=this._initAndGetGatedButton("._8qy","dismissPlaceholder")}a.prototype._initAndGetGatedButton=function(a,c){"use strict";a=b("DOM").scry(this._root,a);if(a.length){a=a[0];b("Event").listen(a,"click",function(){return this.emit(c,this._uploadID)}.bind(this));return a}};a.prototype.getProgressBar=function(){"use strict";return this._progressBar};a.prototype.getRoot=function(){"use strict";return this._root};a.prototype.hide=function(){"use strict";b("CSS").hide(this._root)};a.prototype.show=function(){"use strict";b("CSS").show(this._root)};a.prototype.showRetryButton=function(){"use strict";this._retryButton&&b("CSS").show(this._retryButton)};a.prototype.showErrorOkayButton=function(){"use strict";this._errorOkayButton&&b("CSS").show(this._errorOkayButton)};a.prototype.showErrorCloseButton=function(){"use strict";this._errorCloseButton&&b("CSS").show(this._errorCloseButton)};b("mixInEventEmitter")(a,{cancelButtonClicked:!0,retryButtonClicked:!0,dismissPlaceholder:!0});e.exports=a}),null);
__d("XPhotoBatchEditLocationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/photos/edit/batch/location/",{})}),null);
__d("PhotosBulkEditor",["ix","cx","xuiglyph","ActorURI","Arbiter","AsyncRequest","Button","CSS","DOM","Event","PageTransitions","Parent","PhotosConst","SortableGroup","XPhotoBatchEditLocationController","createIxElement","emptyFunction","mapObject"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j={ASCENDING:"ascending",DESCENDING:"descending",MANUAL:"manual"},k={ascending:g("89980"),descending:g("89944")};function l(a,c,d,e,f,g,h,i,j){"use strict";__p&&__p();this.source=a;if(!c)return;this._root=c;this._reorderButton=b("DOM").scry(this._root.parentNode,"button.reorderButton").pop();this._id=c.getAttribute("id");this._ownerID=j;this._photos={};this._tagger=null;this._options=h;this._isNamespaced=i;this._placeholder=f;this._waitingTemplate=g;this._mentionsData=d;this._placesData=e;this._albumPlace=null;this._userDate=null;this._useDateFromFile=!1;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=this.source===b("PhotosConst").FLASH_UPLOADER;this._coverPhotoSortingID=null;h.canReorder&&this._initSorting(h.autosaveReorder);var k=[b("Arbiter").subscribe(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.INITIALIZED"),this._registerPhoto.bind(this)),b("Arbiter").subscribe([this.mapEventNameToNamespace("PhotosBulkEditablePhoto.REMOVED"),this.mapEventNameToNamespace("PhotosBulkEditablePhoto.ROTATED")],function(a,b){if(this._sortableGroup){a=b.getPhotoData().fbid;this._sortableGroup.removeSortable(a)}delete this._photos[b.getPhotoDataKey()]}.bind(this)),b("Arbiter").subscribe("PhotosBulkEditor.AUTO_ORDER",this._autoOrder.bind(this)),b("Arbiter").subscribe("PhotosBulkBackdateEditor.SAVED",function(a,b){this._useDateFromFile=b.useDateFromFile,this._userDate=b.backdatedDate,this._setDate()}.bind(this)),b("Arbiter").subscribe(["PhotoAlbumPlacesTypeahead.SELECTED_PLACE","PhotoAlbumPlacesTypeahead.EXIST_PLACE","PhotoAlbumPlacesTypeahead.RESET_PLACE"],this._setPlace.bind(this)),b("Arbiter").subscribe("PhotosBulkEditablePhoto.MOVED",function(a,b){this.getPhotoData(b)&&this._photos[b]._doRemove()}.bind(this))];b("Event").listen(this._root,"click",function(a){var c=b("Parent").byClass(a.getTarget(),"editablePhoto"),d=this._photos;b("DOM").scry(this._root,".showControls").forEach(function(a){c!==a&&(b("CSS").removeClass(a,"showControls"),d[a.id].hideMetadataInputs())})}.bind(this));b("PageTransitions").registerHandler(function(){k.forEach(function(a){a.unsubscribe()}),this._tagger&&this._tagger.done()}.bind(this))}l.prototype.init=function(a,b,c,d,e,f){"use strict";l.call(this,this.source,a,b,c,d,e,f)};l.prototype.getRoot=function(){"use strict";return this._root};l.prototype.getSourceString=function(){"use strict";if(this.source===b("PhotosConst").BULK_EDITOR)return"bulk_editor";else if(this.source===b("PhotosConst").FLASH_UPLOADER)return"flash_uploader";else return null};l.prototype.isNamespaced=function(){"use strict";return this._isNamespaced};l.prototype.getVersionConst=function(){"use strict";return this.source};l.prototype.getViewerSource=function(){"use strict";return null};l.prototype.getViewerSet=function(){"use strict";return null};l.prototype.registerTagger=function(a){"use strict";this._tagger=a};l.prototype.needTaggingData=function(){"use strict";return this._tagger&&this._tagger.needTaggingData()};l.prototype.getPhotoData=function(a){"use strict";a=this._photos[a];return a?a.getPhotoData():{}};l.prototype.getPlaceholder=function(){"use strict";return this._placeholder};l.prototype.getWaitingTemplate=function(){"use strict";return this._waitingTemplate};l.prototype.addFaceboxes=function(a){"use strict";this._tagger&&this._tagger.addFaceboxes(a)};l.prototype.mapEventNameToNamespace=function(a){"use strict";return a+(this._isNamespaced?"/"+this._id:"")};l.prototype._registerPhoto=function(a,b){"use strict";__p&&__p();this._setSortMode(j.MANUAL);this._photos[b.getPhotoDataKey()]=b;b.source=this.source;a=b.getPhotoData();var c=a.fbid;this._sortableGroup&&this._sortableGroup.addSortable(c,b.getRoot(),b.getDragHandle());b.swapData(this._mentionsData,this._placesData);this._sortableGroup&&b.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(c)}.bind(this));this._albumPlace&&!b.hasOwnPlaceValue()&&b.setAlbumPlace(this._albumPlace);this._sortableGroup&&this._albumCoverTracksFirstPhoto&&(this._coverPhotoSortingID=this._sortableGroup.getOrder()[0])};l.prototype._recoverPhotos=function(a){"use strict";a=this._photos;for(var c in a){var d=a[c];this._tagger.recoverPhoto(d);b("CSS").addClass(d.getRoot(),"showRecognitionBoxes");d=b("DOM").find(d.getRoot(),"div.uiScaledImageContainer.scaledImage");this.addFaceboxes(d)}};l.prototype._initSorting=function(a){"use strict";__p&&__p();this._setSortMode(j.MANUAL),this._dropCallback=function(c,d,e){__p&&__p();c=this._photos[d.id].getPhotoData();d={order:this._sortableGroup.getOrder(),owner:c.owner};if(a){var f;c.set?(d.set=c.set,f="/ajax/photos/sets/static/reorder.php"):(d.album_fbid=c.albumFBID,f="/ajax/photos/reorder.php");new(b("AsyncRequest"))(f).setData(d).send()}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==d.order[0]){c=this._photos[this._sortableGroup.sortables[d.order[0]].id];c&&this._makeAlbumCover(c);this._coverPhotoSortingID=d.order[0]}e||this._setSortMode(j.MANUAL)}.bind(this),this._sortableGroup=new(b("SortableGroup"))().setDropCallback(this._dropCallback).setBeforeGrabCallback(function(){b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditor.PHOTO_REORDER_START"))}.bind(this))};l.prototype._compare=function(a,b){"use strict";switch(this._sortMode){case j.MANUAL:return this._orderLookup[a.fbid]<this._orderLookup[b.fbid];case j.ASCENDING:return a.timeTaken<b.timeTaken;case j.DESCENDING:return a.timeTaken>b.timeTaken;default:throw new Error("Invalid sort mode")}};l.prototype._setSortMode=function(a){"use strict";if(!this._reorderButton)return;this._sortMode=a;var c=null,d=a!==j.MANUAL;d&&(c=b("createIxElement")(k[a]),b("CSS").addClass(c,"_3-8_"));b("Button").setDepressed(this._reorderButton,d);b("Button").setIcon(this._reorderButton,c)};l.prototype._autoOrder=function(){"use strict";__p&&__p();switch(this._sortMode){case j.MANUAL:var a,c,d=this.getOrder();this._orderLookup={};for(c=0;c<d.length;c++)a=d[c],this._orderLookup[a]=c;this._setSortMode(j.ASCENDING);break;case j.ASCENDING:this._setSortMode(j.DESCENDING);break;case j.DESCENDING:this._setSortMode(j.MANUAL);break;default:throw new Error("Invalid sort mode")}a=this._sortableGroup.getOrder().map(function(a){return this._photos["editablePhoto_"+a].getPhotoData()}.bind(this));this._sortableGroup.setDropCallback(b("emptyFunction"));var e;for(c=0;c<a.length;c++){d=c;for(e=c+1;e<a.length;e++)this._compare(a[e],a[d])&&(d=e);if(c!==d){e=a[d].fbid;var f=a[c].fbid;this._sortableGroup.dragOverHandler(f,e);this._sortableGroup.dropHandler(e);a.splice(c,0,a.splice(d,1)[0])}}f=Object.keys(this._photos)[0];e=this._photos[f];this._dropCallback(e.getPhotoData().fbid,e.getRoot(),!0);this._sortableGroup.setDropCallback(this._dropCallback)};l.prototype._saveCurrentOrder=function(){"use strict";__p&&__p();if(this._photos.length===0)return;var a=this._sortableGroup.getOrder()[0];a=this._photos["editablePhoto_"+a]||this._photos["photoContainer_"+a];if(!a)return;a=a.getPhotoData();if(!a.albumFBID)return;a={order:this._sortableGroup.getOrder(),owner:a.owner,album_fbid:a.albumFBID};new(b("AsyncRequest"))("/ajax/photos/reorder.php").setData(a).send()};l.prototype._setPlace=function(a,c){"use strict";__p&&__p();this._albumPlace=c||null;var d=this._options.batchUpdateLocation,e=[];b("mapObject")(this._photos,function(a,b){if(a.hasOwnPlaceValue())return;a.setAlbumPlace(this._albumPlace,d);d&&e.push(a.getPhotoData().fbid)},this);if(d){a=b("XPhotoBatchEditLocationController").getURIBuilder().getURI();this._ownerID&&(a=b("ActorURI").create(a,this._ownerID));new(b("AsyncRequest"))(a).setData({photo_ids:e,location:this._albumPlace?this._albumPlace.text:"",location_data:this._albumPlace?this._albumPlace.uid:0}).send()}};l.prototype._setDate=function(){"use strict";var a,b=null,c;for(var d in this._photos)c=this._photos[d],this._useDateFromFile||(a=this._userDate.month+"/"+this._userDate.day+"/"+this._userDate.year,b=new Date(a).getTime()),c.setDate(b,!0)};l.prototype._showAlbumCoverSet=function(a){"use strict";this._albumCover&&b("CSS").removeClass(this._albumCover,"checked");a=b("DOM").find(a.getRoot(),".albumCover");b("CSS").addClass(a,"checked");this._albumCover=a};l.prototype._makeAlbumCover=function(a){"use strict";new(b("AsyncRequest"))().setURI("/ajax/photos/album/setcover").setData(a.getPhotoData()).send()};l.prototype.getOrder=function(){"use strict";if(this._sortableGroup)return this._sortableGroup.getOrder();else return[]};l.prototype.hasOrder=function(){"use strict";return!!this._sortableGroup};e.exports=l}),null);
__d("PhotosBulkHeader",["fbt","Arbiter","AsyncRequest","DOM","Event","Form","Run","areJSONRepresentationsEqual","goURI"],(function(a,b,c,d,e,f,g){__p&&__p();function a(a,c,d,e){"use strict";this._form=a,this._formRoot=a!=null&&typeof a.getRoot==="function"?a.getRoot():null,this._isAlbum=c,this._editable=d,this._audience=e,this._backdatedTime=null,this._initialData=null,b("Arbiter").subscribe("PhotosBulkBackdateEditor.SAVED",function(a,c){if(!b("DOM").contains(this._formRoot,c.context))return;this._backdatedTime=c.backdatedDate}.bind(this)),b("Run").onBeforeUnload(function(){return this.isDataDirty()?g._("Some of your changes have not been saved. Would you like to save your changes now?"):void 0}.bind(this)),this._initialData=this.getSerializedData()}a.prototype.getSerializedData=function(){"use strict";var a=b("Form").serialize(this._formRoot);this._backdatedTime&&(a.backTime=this._backdatedTime);return a};a.prototype.isDataDirty=function(){"use strict";return!b("areJSONRepresentationsEqual")(this._initialData,this.getSerializedData())};a.prototype.save=function(a){"use strict";if(!this._editable)return a.call();this._audience&&this._audience.removeHiddenPrivacyWidget&&this._audience.removeHiddenPrivacyWidget();var c=this._isAlbum?"/ajax/photos/album/edit":"/ajax/photos/sets/edit",d=b("Form").serialize(this._formRoot);this._backdatedTime&&(d.backdated_time=this._backdatedTime);new(b("AsyncRequest"))(c).setData(d).setMethod("POST").setHandler(function(){this._initialData=this.getSerializedData(),a()}.bind(this)).send()};a.doneButtonSaveHandler=function(a,c,d){"use strict";var e=a.save.bind(a,function(){b("goURI")(c,!0);return!0});a._listeners=[b("Event").listen(d,"click",e)]};e.exports=a}),null);
__d("TagTypeaheadView",["AsyncRequest","ContextualTypeaheadView","CSS","DOM","FamilyTaggingConfig","Parent"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("ContextualTypeaheadView"));g=c&&c.prototype;function a(a,b){"use strict";g.constructor.call(this,a,b),this.hintText=b.hintText,this.userEd=b.userEd,this.origAutoSelect=b.autoSelect,this.setSuggestions(b.suggestions)}a.prototype.init=function(){"use strict";b("CSS").addClass(this.element,"uiTagTypeaheadView"),g.init.call(this)};a.prototype.buildResults=function(a){"use strict";__p&&__p();!this.value&&this.hintText&&a.unshift({subtext:this.hintText,type:"hintText"});this.userEd&&(new(b("AsyncRequest"))().setURI("/ajax/fof/user_education.php").setData({increment:1}).send(),a.unshift({subtext:this.userEd,type:"userEdText"}));if(b("FamilyTaggingConfig").gk){var c=[],d=[];for(var e=0;e<a.length;e++)a[e].type!=="family_tags"&&a[e].index!=-1e3&&a[e].type!=="hintText"?c.push(a[e]):d.push(a[e]);a=d.concat(c);g.updateResults.call(this,a)}e=g.buildResults.call(this,a);this.userEd&&a.shift();this.value||a.shift();return e};a.prototype.show=function(){"use strict";var a=b("DOM").scry(this.context,".typeaheadBackdrop");a.length>0&&b("CSS").addClass(a[0],"resultsPresent");return g.show.call(this)};a.prototype.hide=function(){"use strict";var a=b("DOM").scry(this.context,".typeaheadBackdrop");a.length>0&&b("CSS").removeClass(a[0],"resultsPresent");return g.hide.call(this)};a.prototype.render=function(a,b,c){"use strict";this.autoSelect=this.origAutoSelect&&a.length,this.disableAutoSelect=a.length===0,b=b.concat(this.getAdditionalResults()),g.render.call(this,a,b,c)};a.prototype.getItems=function(){"use strict";var a=g.getItems.call(this);this.value||a.shift();this.userEd&&a.shift();return a};a.prototype.getSuggestions=function(){"use strict";return this.suggestions};a.prototype.setSuggestions=function(a){"use strict";this.suggestions=a?a.map(String):[],this.visible=!!this.suggestions.length};a.prototype.addSuggestion=function(a){"use strict";this.suggestions.unshift(a)};a.prototype.addTypeaheadFlip=function(a){"use strict";b("CSS").addClass(this.element,a)};a.prototype.removeTypeaheadFlip=function(a){"use strict";b("CSS").removeClass(this.element,a)};a.prototype.getContext=function(){"use strict";var a=b("Parent").byClass(this.element,"typeaheadContainer");if(a)return a;else return g.getContext.call(this)};a.prototype.getAdditionalResults=function(){"use strict";return[]};e.exports=a}),null);
__d("PlacesTypeaheadBehavior",["CSS","DOM"],(function(a,b,c,d,e,f){a={init:function(a,c){a.subscribe(["reset","select","highlight"],function(a,d){a==="highlight"&&d.index!==-1&&d.selected.type!="freeform"&&d.selected.map&&!d.selected.changeCity?(b("DOM").setContent(c,d.selected.map),b("CSS").show(c)):b("CSS").hide(c)})}};e.exports=a}),null);
__d("DisablePlatformButton",["CSS","Event","ge"],(function(a,b,c,d,e,f){__p&&__p();var g=!1;a={init:function(a){__p&&__p();for(var c=0;c<a.length;c++){var d=b("ge")(a[c]);b("Event").listen(d,"click",function(c){if(g)return!1;else{g=!0;for(var c=0;c<a.length;c++)b("CSS").addClass(a[c],"uiButtonDisabled")}})}}};e.exports=a}),null);
__d("FreeformTokenizerBehavior",["Event","Input","Keys"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c){__p&&__p();var d=c.matcher&&new RegExp(c.matcher,"i"),e=c.splitter&&new RegExp(c.splitter),f=c.tokenize_on_blur!==!1,g=c.tokenize_on_paste!==!1,h=c.split_on_check===!0,i=c.select_on_comma!==!1,j=c.select_on_space===!0,k=c.never_submit===!0;function l(c){__p&&__p();var f=b("Input").getValue(a.getInput()).trim();e&&c&&c.type=="paste"?f=f.split(e):e&&h?f=f.split(e):f=[f];var g=!1;for(var i=0;i<f.length;i++){var j=f[i].trim();if(j&&(!d||d.test(j))){j={uid:j,text:j,freeform:!0};a.addToken(a.createToken(j));g=!0}}c&&g&&(a.getTypeahead().getCore().afterSelect(),c.kill())}a.subscribe("keydown",function(c,d){c=d.event;d=b("Event").getKeyCode(c);if(d==b("Keys").RETURN||i&&d==b("Keys").COMMA||j&&d==b("Keys").SPACE){var e=a.getTypeahead().getView();e.getSelection()?(e.select(),c.kill()):l(c)}d==b("Keys").RETURN&&k&&c.kill()});a.subscribe("paste",function(a,b){g&&setTimeout(l.bind(null,b.event),20)});a.subscribe("blur",function(b,c){f&&l(),a.getTypeahead().getCore().reset()})}e.exports=a}),null);
__d("TypeaheadHintText",["emptyFunction"],(function(a,b,c,d,e,f){function a(a){"use strict";this._typeahead=a}a.prototype.enable=function(){"use strict";this._typeahead.getCore().resetOnKeyup=!1};Object.assign(a.prototype,{disable:b("emptyFunction")});e.exports=a}),null);
__d("legacy:HintTextTypeaheadBehavior",["TypeaheadHintText"],(function(a,b,c,d,e,f){a.TypeaheadBehaviors||(a.TypeaheadBehaviors={}),a.TypeaheadBehaviors.hintText=function(a){a.enableBehavior(b("TypeaheadHintText"))}}),3);
__d("legacy:ShowResultsOnFocusTypeaheadBehavior",["TypeaheadShowResultsOnFocus"],(function(a,b,c,d,e,f){a.TypeaheadBehaviors||(a.TypeaheadBehaviors={}),a.TypeaheadBehaviors.showResultsOnFocus=function(a){a.enableBehavior(b("TypeaheadShowResultsOnFocus"))}}),3);
__d("legacy:xd-arbiter",["XdArbiter"],(function(a,b,c,d,e,f){b("XdArbiter")}),3);